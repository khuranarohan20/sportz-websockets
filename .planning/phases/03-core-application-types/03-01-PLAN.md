---
phase: 03-core-application-types
plan: 01
type: execute
---

<objective>
Convert the main Express application setup and server initialization to TypeScript with full type safety.

Purpose: Establish type-safe server initialization, Express app configuration, and WebSocket integration as the foundation for all route handlers.
Output: Fully typed `server/src/index.ts` with Express application, HTTP server, and WebSocket server setup.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STACK.md
@.planning/codebase/STRUCTURE.md
@.planning/phases/01-typescript-foundation/01-01-SUMMARY.md
@.planning/phases/01-typescript-foundation/01-02-SUMMARY.md
@.planning/phases/01-typescript-foundation/01-03-SUMMARY.md
@server/src/index.js
@server/src/config/arcjet.js
@server/src/ws/server.js
@server/src/routes/matches.js
@server/src/routes/commentary.js

**Tech stack available from Phase 1:**
- TypeScript 5.9.3 with strict type checking
- tsx 4.21.0 for execution
- @types/express@5.0.6 for Express types
- @types/ws for WebSocket types

**Established patterns from Phase 1:**
- Pattern 1: Use tsx watch for hot-reload development
- Pattern 2: No any types allowed (strict null checks, implicit any enforcement)
- Pattern 3: Custom types go in src/types/ directory
- Pattern 4: Run type-check:watch for continuous type validation

**Assuming Phase 2 completed:**
- Database schemas typed (schema.ts)
- Database client typed (db.ts)
- Inferred types exported (Match, NewMatch, Commentary, NewCommentary)

**Key files to reference:**
- server/src/index.js - Current JavaScript entry point
- server/src/config/arcjet.js - Security middleware (will be .ts after 03-02)
- server/src/ws/server.js - WebSocket server (will be .ts after Phase 5)

**Constraining decisions from Phase 1:**
- Use @types/express for Express typings (already installed)
- Strict type checking with no any types
- ES2022 target with bundler module resolution
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rename index.js to index.ts and add Express type annotations</name>
  <files>server/src/index.ts</files>
  <action>Rename server/src/index.js to server/src/index.ts. Add explicit type annotations for Express app and HTTP server:
  - Type `app` variable as `express.Application` from @types/express
  - Type `server` variable as `http.Server` from @types/http
  - Type `PORT` and `HOST` variables (already inferred, can add explicit types)
  - Type `broadcastMatchCreated` and `broadcastCommentary` functions as `Function` or more specific if possible
  Use ambient import from 'express' and 'http' packages for type definitions. No logic changes - only type annotations added.</action>
  <verify>npm run type-check passes with no errors in index.ts</verify>
  <done>index.ts renamed, all Express and HTTP types properly annotated, no type errors</done>
</task>

<task type="auto">
  <name>Task 2: Update import statements for TypeScript extensions</name>
  <files>server/src/index.ts</files>
  <action>Update all import statements in index.ts to use .ts extensions:
  - Change `./config/arcjet.js` to `./config/arcjet.ts` (will exist after 03-02)
  - Change `./config/env.js` to `./config/env.ts` (will exist after 03-02)
  - Change `./routes/matches.js` to `./routes/matches.ts` (will exist after Phase 4)
  - Change `./routes/commentary.js` to `./routes/commentary.ts` (will exist after Phase 4)
  - Change `./ws/server.js` to `./ws/server.ts` (will exist after Phase 5)
  Native ES modules require explicit file extensions. Update imports now so file is ready when those files are converted.</action>
  <verify>All import paths use .ts extensions, no module resolution errors from TypeScript compiler</verify>
  <done>All imports updated to .ts extensions, TypeScript compiler resolves paths correctly</done>
</task>

<task type="auto">
  <name>Task 3: Add type annotations for app.locals broadcast functions</name>
  <files>server/src/index.ts</files>
  <action>Add type safety to app.locals broadcast function assignments:
  - Type `broadcastMatchCreated` as `(matchData: any) => void` for now (will be refined to proper match type after Phase 4)
  - Type `broadcastCommentary` as `(commentaryData: any) => void` for now (will be refined after Phase 4)
  - Use Express's `Application` type extension or.locals property
  - Add comment explaining these will be properly typed after routes are converted in Phase 4
  This allows the file to compile with strict types while acknowledging the temporary use of any during conversion.</action>
  <verify>npm run type-check passes, app.locals assignments are type-safe</verify>
  <done>app.locals properly typed with broadcast functions, TypeScript compiler satisfied</done>
</task>

</tasks>

<verification>
Before declaring this plan complete:
- [ ] `npm run type-check` passes with no errors
- [ ] `npm run lint` passes with no errors
- [ ] Server starts successfully with `npm run dev`
- [ ] No runtime errors in server initialization
- [ ] WebSocket server initializes correctly
- [ ] All import paths use .ts extensions
</verification>

<success_criteria>

- server/src/index.js renamed to server/src/index.ts
- All Express, HTTP, and WebSocket types properly annotated
- TypeScript compiler validates the file with zero errors
- Server starts and runs without runtime issues
- All imports use .ts extensions for future compatibility
  </success_criteria>

<output>
After completion, create `.planning/phases/03-core-application-types/03-01-SUMMARY.md`:

# Phase 3 Plan 1: Express App Setup Summary

**Converted main Express application setup and server initialization to TypeScript.**

## Accomplishments

- Renamed index.js to index.ts with full type annotations
- Added Express.Application and http.Server types
- Updated all import paths to .ts extensions
- Added type annotations for app.locals broadcast functions

## Files Created/Modified

- `server/src/index.ts` - Converted from JavaScript to TypeScript

## Decisions Made

- Used temporary `any` types for broadcast functions (will be properly typed after Phase 4)
- Updated all imports to .ts extensions ahead of time to avoid future changes

## Issues Encountered

None

## Next Step

Ready for 03-02-PLAN.md (Configuration and Environment Handling)
</output>
