---
phase: 04-api-routes-middleware
plan: 01
type: execute
---

<objective>
Convert Zod validation schemas to TypeScript for type-safe request validation.

Purpose: Validation schemas are imported by route handlersâ€”converting them first enables type inference in routes.

Output: TypeScript validation schemas with proper type exports for route handlers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md

# Auto-selected based on dependency graph (from frontmatter):
@.planning/phases/03-core-application-types/03-02-SUMMARY.md

# Key files from frontmatter (relevant to this phase):
@server/src/validation/matches.js
@server/src/validation/commentary.js
@server/src/db/db.ts

# Tech stack available: typescript, zod
# Established patterns: .js extensions in TypeScript imports, strict type checking
# Constraining decisions:
# - [Phase 3]: Use .js extensions in import paths for TypeScript files
# - [Phase 3]: Re-export types from central db.ts for convenient imports
# - [Phase 2]: Zod schemas provide automatic type inference via .infer
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert matches validation schema to TypeScript</name>
  <files>server/src/validation/matches.ts</files>
  <action>Rename matches.js to matches.ts. Export inferred types from Zod schemas:
- ListMatchesQuery (from listMatchesQuerySchema)
- MatchIdParam (from matchIdParamSchema)
- CreateMatchInput (from createMatchSchema)
- UpdateScoreInput (from updateScoreSchema)

Use z.infer<> to generate types from schemas. Export types alongside schemas for use in route handlers.</action>
  <verify>tsc --noEmit succeeds (type-check passes), exports visible in editor</verify>
  <done>Schemas typed correctly, inferred types exported, no TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 2: Convert commentary validation schema to TypeScript</name>
  <files>server/src/validation/commentary.ts</files>
  <action>Rename commentary.js to commentary.ts. Export inferred types:
- ListCommentaryQuery (from listCommentaryQuerySchema)
- CreateCommentaryInput (from createCommentarySchema)

Use z.infer<> to generate types. Export types alongside schemas.</action>
  <verify>tsc --noEmit succeeds, types exported correctly</verify>
  <done>Schemas typed, types exported, no compilation errors</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run type-check` passes with no errors
- [ ] All inferred types are exported (ListMatchesQuery, MatchIdParam, CreateMatchInput, UpdateScoreInput, ListCommentaryQuery, CreateCommentaryInput)
- [ ] No changes to schema logic (pure type conversion)
</verification>

<success_criteria>

- All validation schemas converted to TypeScript
- Inferred types exported for use in route handlers
- No TypeScript compilation errors
- Zod validation logic unchanged
  </success_criteria>

<output>
After completion, create `.planning/phases/04-api-routes-middleware/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Validation Schemas Summary

**Converted Zod validation schemas to TypeScript with inferred type exports.**

## Accomplishments

- Renamed validation files to .ts and added inferred type exports
- Exported ListMatchesQuery, MatchIdParam, CreateMatchInput, UpdateScoreInput types
- Exported ListCommentaryQuery, CreateCommentaryInput types
- TypeScript compilation passes without errors

## Files Created/Modified

- `server/src/validation/matches.ts` - Renamed from .js, added type exports
- `server/src/validation/commentary.ts` - Renamed from .js, added type exports

## Decisions Made

None - straightforward type conversion following established patterns.

## Issues Encountered

None.

## Next Step

Ready for 04-02-PLAN.md (Match Routes Conversion)
</output>
