---
phase: 06-performance-profiling
plan: 01
type: execute
---

<objective>
Run comprehensive load tests across all endpoints and establish baseline performance metrics.

Purpose: Document current performance characteristics before optimization work. These baselines enable measuring improvement impact in Phase 7.
Output: Baseline metrics document showing req/sec, latency percentiles, and throughput for each endpoint type.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-performance-profiling/06-RESEARCH.md
@server/load-tests/run-performance-tests.js
@server/load-tests/run-load-tests.js
@server/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run existing performance test suite</name>
  <files>server/load-tests/run-performance-tests.js, server/profiling/06-01-baseline.md</files>
  <action>
    Execute the existing performance test suite:
    1. Start server: cd server && npm start
    2. In another terminal: node load-tests/run-performance-tests.js
    3. The script tests multiple concurrency levels (10, 50, 100, 200, 500, 1000 connections)
    4. Capture all output metrics for each test scenario

    The test script already exists and tests:
    - Health endpoint baseline
    - Match creation (POST /matches)
    - Commentary creation (POST /matches/:id/commentary)
    - Score updates (PATCH /matches/:id/score)

    Save the complete output to server/profiling/06-01-baseline.md for documentation.
  </action>
  <verify>File server/profiling/06-01-baseline.md exists with complete test output showing req/sec, latency percentiles (p50, p99, max), and error rates for all concurrency levels</verify>
  <done>Complete performance test results documented in 06-01-baseline.md covering all endpoints and concurrency levels</done>
</task>

<task type="auto">
  <name>Task 2: Run WebSocket load test and document results</name>
  <files>server/load-tests/websocket-load.js, server/profiling/06-01-baseline.md</files>
  <action>
    Execute the existing WebSocket load test:
    1. Ensure server is running
    2. Run: node load-tests/websocket-load.js
    3. The test creates concurrent WebSocket connections and measures message throughput
    4. Append results to the baseline document

    The WebSocket test covers:
    - Connection establishment rate
    - Subscribe/unsubscribe performance
    - Message broadcast throughput
    - Connection memory usage

    Document results in server/profiling/06-01-baseline.md.
  </action>
  <verify>06-01-baseline.md includes WebSocket section with connection count, messages/sec, and any errors observed</verify>
  <done>WebSocket performance metrics added to baseline document</done>
</task>

<task type="auto">
  <name>Task 3: Create baseline metrics summary</name>
  <files>server/profiling/06-01-baseline.md, server/profiling/BASELINE.md</files>
  <action>
    Create a concise baseline metrics summary (server/profiling/BASELINE.md) that extracts key numbers from the full test results. Include:

    1. **Endpoint Performance Summary** - Table showing:
       - Endpoint name
       - Max sustainable req/sec (before degradation)
       - p50 latency at 50 concurrent connections
       - p99 latency at 50 concurrent connections
       - Failure point (concurrency level where errors begin)

    2. **System Bottlenecks Observed** - List:
       - CPU bottlenecks (if any)
       - Memory usage patterns
       - Database write performance limitations
       - WebSocket connection limits

    3. **Comparison with Known Metrics** - Cross-reference:
       - Health endpoint vs. known baseline (~36,889 req/sec from STATE.md)
       - Database operations vs. known baseline (~40-50 req/sec from STATE.md)
       - Explain any significant deviations

    This summary will be the reference point for measuring Phase 7 improvements.
  </action>
  <verify>File server/profiling/BASELINE.md exists with endpoint performance table, bottleneck list, and baseline comparison section</verify>
  <done>Concise baseline metrics summary created documenting current performance characteristics</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All performance tests executed successfully
- [ ] Baseline document (06-01-baseline.md) contains complete test output
- [ ] Summary (BASELINE.md) extracts key metrics and identifies bottlenecks
- [ ] Results are compared against known baselines from STATE.md
</verification>

<success_criteria>
- Complete performance test results documented
- Baseline metrics established for all endpoint types
- System bottlenecks identified and documented
- Baseline summary created for Phase 7 reference
</success_criteria>

<output>
After completion, create `.planning/phases/06-performance-profiling/06-01-SUMMARY.md`:

# Phase 6 Plan 1: Load Testing & Baseline Metrics Summary

**Established comprehensive performance baselines across all endpoints.**

## Accomplishments

- Executed full performance test suite (6 concurrency levels)
- Documented WebSocket performance under load
- Created baseline metrics summary for Phase 7 reference

## Files Created/Modified

- `server/profiling/06-01-baseline.md` - Complete test output
- `server/profiling/BASELINE.md` - Baseline metrics summary

## Key Findings

- [Max req/sec observed, bottlenecks identified]
- [Comparison with STATE.md baselines]
- [Performance degradation points]

## Next Step

Ready for 06-02-PLAN.md (Database Profiling)
</output>
