---
phase: 01-typescript-foundation
type: execute
---

<objective>
Setup type definitions for all dependencies and create project-level type definitions.

Purpose: Ensure full type coverage for external dependencies and create type definitions for environment variables and Node.js globals, eliminating any implicit `any` types in the ecosystem.

Output: Complete @types packages installed and custom type definition files created.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-typescript-foundation/01-01-SUMMARY.md
@server/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @types packages for all dependencies</name>
  <files>server/package.json</files>
  <action>Run `cd server && npm install -D @types/node @types/express @types/ws`. These provide TypeScript definitions for Node.js globals, Express, and WebSocket library. Note: @types/pg, @types/dotenv, and @types/drizzle-orm are NOT needed - these packages include their own types. zod@4.3.6 includes built-in types. @arcjet/node includes types (check after install). Install only what's missing - don't install unnecessary @types packages.</action>
  <verify>cd server && npm list @types/node @types/express @types/ws shows all installed</verify>
  <done>All required @types packages installed, no duplicate type definitions</done>
</task>

<task type="auto">
  <name>Task 2: Create global type definitions for environment variables</name>
  <files>server/src/types/env.d.ts</files>
  <action>Create `server/src/types/env.d.ts` to define environment variable types:
```typescript
/// <reference types="node" />

interface ProcessEnv {
  NODE_ENV?: string;
  PORT?: string;
  HOST?: string;
  DATABASE_URL: string;
  ARCJET_KEY?: string;
  ARCJET_MODE?: 'LIVE' | 'DRY_RUN';
}

declare global {
  namespace NodeJS {
    interface ProcessEnv extends ProcessEnv {}
  }
}

export {};
```
This provides type-safe access to process.env throughout the application. The `declare global` augmentation extends the global NodeJS.ProcessEnv interface. Add only env vars that are actually used (from .env and CLAUDE.md).</action>
  <verify>Type a reference to process.env.DATABASE_URL in any TypeScript file - shows as string, not any</verify>
  <done>env.d.ts exists, process.env properties are typed correctly</done>
</task>

<task type="auto">
  <name>Task 3: Update tsconfig.json to include type definitions</name>
  <files>server/tsconfig.json</files>
  <action>Add "typeRoots" and "types" to compilerOptions in tsconfig.json:
```json
{
  "compilerOptions": {
    // ... existing options ...
    "typeRoots": ["./node_modules/@types", "./src/types"],
    "types": ["node"]
  }
}
```
This ensures TypeScript finds both installed @types packages and custom type definitions in src/types/. The "types": ["node"] explicitly includes Node.js types (other @types are auto-included).</action>
  <verify>cd server && npx tsc --noEmit respects the typeRoots configuration</verify>
  <done>tsconfig.json includes typeRoots pointing to src/types/ and node_modules/@types</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All @types packages installed (check which packages need them)
- [ ] `server/src/types/env.d.ts` exists with process.env interface
- [ ] `server/tsconfig.json` includes typeRoots configuration
- [ ] `cd server && npx tsc --noEmit` passes with type definitions
</verification>

<success_criteria>

- All required @types packages installed
- Custom type definition file created for environment variables
- tsconfig.json configured to find all type definitions
- No implicit `any` types from external dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/01-typescript-foundation/01-02-SUMMARY.md`:

# Phase 1 Plan 2: Type Definitions Setup Summary

**Installed all required type definitions and created custom types for environment variables.**

## Accomplishments

- Installed @types packages for dependencies that don't include their own types
- Created src/types/env.d.ts for type-safe environment variable access
- Updated tsconfig.json to include custom type definitions directory

## Files Created/Modified

- `server/package.json` - Added @types packages
- `server/src/types/env.d.ts` - New environment variable type definitions
- `server/tsconfig.json` - Added typeRoots configuration

## Decisions Made

- Only installed @types for packages without built-in types (Express, ws)
- Used global augmentation for process.env to provide types everywhere
- Created src/types/ directory for custom type definitions

## Issues Encountered

None

## Next Step

Ready for 01-03-PLAN.md - Configure development workflow (watch mode, type checking, linting)
</output>
