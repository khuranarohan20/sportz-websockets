# Codebase Structure

**Analysis Date:** 2025-02-15

## Directory Layout

```
sports/
└── server/              # Main application directory
    ├── src/             # Source code
    │   ├── config/      # Configuration and middleware
    │   ├── constants/   # Application constants
    │   ├── db/          # Database layer
    │   ├── routes/      # API routes
    │   ├── utils/       # Utility functions
    │   ├── validation/  # Request validation schemas
    │   └── ws/          # WebSocket implementation
    ├── drizzle/         # Database migrations
    ├── load-tests/      # Load testing scripts
    ├── .env             # Environment variables (gitignored)
    ├── CLAUDE.md        # Project documentation
    ├── drizzle.config.js # Drizzle ORM configuration
    ├── package.json     # Dependencies and scripts
    └── package-lock.json # Locked dependencies
```

## Directory Purposes

**server/src/config/**:
- Purpose: Configuration and middleware setup
- Contains: Arcjet security middleware, environment loading
- Key files: `arcjet.js` (security config), `env.js` (environment variables)
- Subdirectories: None

**server/src/constants/**:
- Purpose: Application-wide constants
- Contains: Arcjet rate limits, match query limits, WebSocket settings
- Key files: `arcjet.js`, `match.js`, `ws.js`
- Subdirectories: None

**server/src/db/**:
- Purpose: Database connection and schema definitions
- Contains: Drizzle ORM setup, table schemas
- Key files: `db.js` (connection pool), `schema.js` (matches, commentary tables)
- Subdirectories: None

**server/src/routes/**:
- Purpose: HTTP API endpoints
- Contains: Express routers for matches and commentary
- Key files: `matches.js`, `commentary.js`
- Subdirectories: None

**server/src/utils/**:
- Purpose: Helper functions and business logic
- Contains: Match status calculation utilities
- Key files: `match-status.js`
- Subdirectories: None

**server/src/validation/**:
- Purpose: Request validation schemas
- Contains: Zod schemas for API endpoints
- Key files: `matches.js`, `commentary.js`
- Subdirectories: None

**server/src/ws/**:
- Purpose: WebSocket server implementation
- Contains: WebSocket connection handling and pub/sub logic
- Key files: `server.js`
- Subdirectories: None

**server/drizzle/**:
- Purpose: Database migration files
- Contains: SQL migrations generated by Drizzle Kit
- Subdirectories: None

**server/load-tests/**:
- Purpose: Load testing scripts
- Contains: Autocannon test scripts for performance testing
- Key files: `run-load-tests.js`, `match-creation.js`, `commentary-creation.js`, `websocket-load.js`
- Subdirectories: None

## Key File Locations

**Entry Points:**
- `server/src/index.js` - Main application entry point (Express + WebSocket servers)

**Configuration:**
- `server/package.json` - Project metadata and dependencies
- `server/drizzle.config.js` - Database ORM configuration
- `server/.env` - Environment variables (not in version control)

**Core Logic:**
- `server/src/routes/` - API route handlers
- `server/src/db/` - Database operations and schema
- `server/src/ws/` - Real-time communication
- `server/src/utils/` - Business logic utilities

**Testing:**
- `server/load-tests/` - Performance/load testing with autocannon

**Documentation:**
- `server/CLAUDE.md` - Developer documentation
- `server/LOAD_TEST_REPORT.md` - Performance test results

## Naming Conventions

**Files:**
- kebab-case.js for all JavaScript files (e.g., `match-status.js`, `arcjet.js`)
- Directory names are kebab-case (e.g., `load-tests`, `commentary.js`)

**Directories:**
- kebab-case for all directories
- Plural names for collections (`routes`, `constants`, `utils`)

**Special Patterns:**
- `index.js` for main entry points
- `.js` extension for all JavaScript files (native ES modules)

## Where to Add New Code

**New Feature (API endpoint):**
- Primary code: `server/src/routes/` (new router file)
- Validation: `server/src/validation/` (new schema file)
- Constants: `server/src/constants/` (if needed)

**New Feature (WebSocket event):**
- Implementation: `server/src/ws/server.js` (add broadcast function)
- Constants: `server/src/constants/` (if needed)

**New Database Table:**
- Schema: `server/src/db/schema.js` (add table definition)
- Migration: Generate with `npm run db:generate`

**New Utility Function:**
- Implementation: `server/src/utils/` (new file)

**New Constants:**
- Implementation: `server/src/constants/` (new file)

## Special Directories

**server/drizzle/**:
- Purpose: Database migration files
- Source: Auto-generated by Drizzle Kit
- Committed: Yes

**server/load-tests/**:
- Purpose: Performance testing scripts
- Source: Manual creation for load testing
- Committed: Yes

---

*Structure analysis: 2025-02-15*
*Update when directory structure changes*
